<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.3.xsd">
<header>
	<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
	<title lang="en">User Blog Mod</title>
	<description lang="en">Adds Blogs to a phpBB3 board.</description>

	<author-notes lang="en">PHP versions less than 5.1.0 are NOT supported.

Support by the author is only provided at http://www.lithiumstudios.org
A small fee is required for support by the author unless otherwise specified by the author in the release topic.
Bug reports are accepted and, if confirmed as a bug, you will receive support for fixing the bug for free by the mod author.</author-notes>

	<author-group>
		<author>
			<username>EXreaction</username>
			<realname>Nathan Guse</realname>
			<homepage>http://www.lithiumstudios.org/</homepage>
			<email>exreaction@lithiumstudios.org</email>
		</author>
	</author-group>

	<mod-version>1.0.11-pl1</mod-version>

	<installation>
		<level>easy</level>
		<time>180</time>
		<target-version>3.0.6</target-version>
	</installation>
</header>

<action-group>
	<copy>
		<file from="root/*.*" to="*.*" />
	</copy>
	<open src="includes/acp/acp_language.php">
		<edit>
			<find><![CDATA[, 'button_topic_reply']]></find>
			<inline-edit>
				<inline-find><![CDATA[, 'button_topic_reply']]></inline-find>
				<inline-action type="after-add"><![CDATA[, 'button_blog_new']]></inline-action>
			</inline-edit>
		</edit>
	</open>
	<open src="includes/acp/acp_styles.php">
		<edit>
			<find><![CDATA[, 'button_topic_reply']]></find>
			<inline-edit>
				<inline-find><![CDATA[, 'button_topic_reply']]></inline-find>
				<inline-action type="after-add"><![CDATA[, 'button_blog_new']]></inline-action>
			</inline-edit>
		</edit>
		<edit>
			<find>				$sql = 'UPDATE ' . FORUMS_TABLE . "
					SET forum_style = $new_id
					WHERE forum_style = $style_id";
				$db->sql_query($sql);</find>
			<action type="after-add">				// Start User Blog Mod ----------------------
				global $phpEx;
				include("{$phpbb_root_path}blog/includes/functions_admin.$phpEx");
				blog_remove_style($style_id, $new_id);
				// End User Blog Mod ------------------------</action>
		</edit>
	</open>
	<open src="styles/prosilver/imageset/en/imageset.cfg">
		<edit>
			<comment lang="en">Do this for all prosilver based styles and all languages.</comment>
			<find><![CDATA[img_button_topic_reply = button_topic_reply.gif*25*96]]></find>
			<action type="after-add"><![CDATA[
# User Blog Mod
img_button_blog_new = button_blog_new.gif*25*96]]></action>
		</edit>
	</open>
	<open src="styles/prosilver/template/overall_footer.html">
		<edit>
			<comment lang="en">Do this for all prosilver based styles.</comment>
			<find><![CDATA[<!-- IF TRANSLATION_INFO --><br />{TRANSLATION_INFO}<!-- ENDIF -->]]></find>
			<action type="after-add"><![CDATA[		<!-- IF BLOG_CREDITS --><br />{BLOG_CREDITS}<!-- ENDIF -->]]></action>
		</edit>
	</open>
	<open src=".htaccess">
		<edit>
			<find><![CDATA[Rewriterule ^blog/(.+)/(.+).html$		./blog/view/blog.php?page=$1&mode=$2
Rewriterule ^blog/(.+).html$			./blog/blog.php?page=$1
Rewriterule ^blog/(.+)/$				./blog/view/blog.php?page=$1
Rewriterule ^blog/$						./blog/blog.php]]></find>
			<action type="replace-with"><![CDATA[Rewriterule ^blog/(.+)/(.+).html$		./blog/view/blog.php?page=$1&mode=$2 [NC]
Rewriterule ^blog/(.+).html$			./blog/blog.php?page=$1 [NC]
Rewriterule ^blog/(.+)/$				./blog/view/blog.php?page=$1 [NC]
Rewriterule ^blog/$						./blog/blog.php [NC]

RewriteCond %{REQUEST_FILENAME} !-f
Rewriterule ^blog/(.+)/(.+)$		./blog/view/blog.php?page=$1&mode=$2 [NC]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^blog/(.+)$ ./blog/blog.php?page=$1 [NC]]]></action>
		</edit>
	</open>
	<diy-instructions lang="en">Go to ACP->Styles->Style Components->Theme, then hit the Refresh button next to prosilver.
Go to ACP->Styles->Style Components->Imageset, then hit the Refresh button next to prosilver.

Go to yoursite/blog/database.php in your web browser to update the database.

Because of the bug in previous versions of EAMI that were used to install the modules, the left and right id's for your modules are likely messed up.
To fix this, go to this page and follow the instructions on how to run the script (and run it for your board):
http://www.lithiumstudios.org/forum/viewtopic.php?f=9&amp;t=691</diy-instructions>
</action-group>
</mod>