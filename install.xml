<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.2.xsd">
<header>
	<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
	<title lang="en">User Blog Mod</title>
	<description lang="en">Adds Blogs to a phpBB3 board.</description>

	<author-notes lang="en">PHP versions less than 5.1.0 are NOT supported.

Support by the author is only provided at http://www.lithiumstudios.org
A small fee is required for support by the author unless otherwise specified by the author in the release topic.
Bug reports are accepted and, if confirmed as a bug, you will receive support for fixing the bug for free by the mod author.</author-notes>

	<author-group>
		<author>
			<username>EXreaction</username>
			<realname>Nathan Guse</realname>
			<homepage>http://www.lithiumstudios.org/</homepage>
			<email>exreaction@lithiumstudios.org</email>
		</author>
	</author-group>

	<mod-version>1.0.11-dev</mod-version>

	<installation>
		<level>intermediate</level>
		<time>600</time>
		<target-version>3.0.4</target-version>
	</installation>

	<history>
		<entry>
			<date>2008-04-29</date>
			<rev-version>1.0.0</rev-version>
			<changelog lang="en">
				<change>Changing the way the BLOG_USE_ROOT is handled in the blog/includes/functions.php file.  Now the variable must be named BLOG_ROOT, and it takes a string holding the path from your server's root path.</change>
				<change>Fixing the (previously broken) output ordering of plugins.</change>
				<change>Moving the hardcodded &lt; PHP 5.1.0 error string to the setup.php language file.</change>
				<change>Changing the way the SQL query is handled in blog_data.php.  Now the $sql_where is put in $sql_ary['WHERE'] to match the rest of the SQL code.</change>
				<change>Changing the credits text.  Now it is "Blogs powered by User Blog Mod © EXreaction" instead of "Blog System powered by User Blog Mod © EXreaction"</change>
				<change>Changing all &lt;br/&gt; to &lt;br /&gt;</change>
				<change>To update from RC2, upload all of the new files, then run the upgrade script at blog.php?page=update.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-05-11</date>
			<rev-version>1.0.1</rev-version>
			<changelog lang="en">
				<change>Adding an uninstaller.  You can now uninstall the stuff added in the database by going to blog/uninstall.php and following it's instructions.</change>
				<change>Outputting the blog link and text to PROFILE_BLOG, and the link to U_VIEW_BLOG in the parent block as well with add_blog_links.</change>
				<change>Adding a new option in the ACP to disable showing the blog link in the Custom Profile Fields in view topic/view profile.</change>
				<change>Fixing a potential bug that could affect some browsers when trying to submit the UCP form.</change>
				<change>Fixing the bug with the smilies popup in the UCP for subsilver2 (http://www.lithiumstudios.org/forum/viewtopic.php?f=41&amp;t=683)</change>
				<change>Fixing a hole where users could rate items higher or lesser than the max/min allowed rating.</change>
				<change>Fixing the alt text on rating images.</change>
				<change>Fixing a minor overlook which resulted in a big problem with EAMI.  When updating, you should also run this (there is a note about this in the update instructions as well): http://www.lithiumstudios.org/forum/viewtopic.php?f=9&amp;t=691</change>
				<change>Fixing a bug in pagination where the last page link was not going to the actual last page.</change>
				<change>Adding an output for the total blog entries in the header.</change>
				<change>Adding function to delete all blogs by a user.</change>
				<change>Adding instructions to more fully integrate the User Blog Mod with phpBB3.  Those instructions can be found in contrib/install_extended.xml.</change>
				<change>Fixing the blog_posting_layout to get rid of a javascript error when submitting.</change>
				<change>Fixing the T_BLOG_TEMPLATE_PATH, etc (exact change noted below in NOTE FOR BLOG STYLERS).  Adding a / at the end of them, like they should have had in the first place.</change>
				<change>A few other minor changes/fixes.</change>
				<change>NOTE FOR BLOG STYLERS: The paths for T_BLOG_TEMPLATE_PATH, T_BLOG_IMAGESET_PATH, and T_BLOG_IMAGESET_LANG_PATH have been altered.  They now have a / at the end of them.</change>
				<change>NOTE FOR TRANSLATORS: 2 new language fields have been added in the mods/blog/acp.php file, 1 new language field was added to mods/blog/common.php, and a new language file, mods/blog/viewonline.php, was added.</change>
				<change>To update from 1.0.0 follow the instructions in contrib/update/100_to_101.xml.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-05-30</date>
			<rev-version>1.0.2</rev-version>
			<changelog lang="en">
				<change>Adding an output of the last blogs since last visit.  There is currently no link to it, but it is available at blog/view/last_visit_blogs.html</change>
				<change>Fixing a bug in the blog_delete_user function (forgot to include the constants file).</change>
				<change>Correcting a lot of entries in the permissions language file.</change>
				<change>Adding a new function to the plugins class to make it easier to add to the to-do list in the plugins class.</change>
				<change>Allowing the option for each style to have access to the plugins system.  If a file named style_plugin.php exists in the style directory it will be loaded when somebody accesses a blog with that style.  This allows style authors to make changes to the output data for their specific style and make styling much more flexible and powerful.</change>
				<change>Fixing 2 bugs when adding/editing a poll.</change>
				<change>Fixing another bug in attachements while editing a comment.</change>
				<change>Adding a new style named Coda.  This was copied and modified from the wordpress style on http://coda.co.za/blog/</change>
				<change>NOTE FOR TRANSLATORS: 1 new language field has been added in the mods/blog/view.php file and the acp/permissions_blog.php file has been re-done.</change>
				<change>To update from 1.0.1 follow the instructions in contrib/update/101_to_102.xml.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-06-12</date>
			<rev-version>1.0.3</rev-version>
			<changelog lang="en">
				<change>Updating to ModX 1.2.0.</change>
				<change>Adding $current_version variable in the plugin update function just before the update script for the plugin is called.</change>
				<change>Fixing the "Go to extension management screen" url in the Manage extension groups ACP panel.</change>
				<change>When installing/updating/uninstalling a plugin check to see if the install/update/uninstall file exists before trying to include it.</change>
				<change>Putting in some code for the Blog Title, Blog Description to prevent having a messed up page when neither is entered in by the user.</change>
				<change>Saving 2 SQL queries when there are no polls in the requested blogs.</change>
				<change>NOTE FOR TRANSLATORS: No language entries have been changed.</change>
				<change>To update from 1.0.2 follow the instructions in contrib/update/102_to_103.xml.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-07-10</date>
			<rev-version>1.0.4</rev-version>
			<changelog lang="en">
				<change>Fixing the bug where a user's blog style could cause a no style error when deleting a style from the ACP.</change>
				<change>Fixing the bug which occured when deleting a user's blogs with the blog_delete_user function.</change>
				<change>Fixing the conflict with one of the Feed Mods by renaming U_FEED to U_BLOG_FEED.</change>
				<change>Fixing the conflict with the Select Viewable Custom Profiles Mod.</change>
				<change>Fixing a lot of things for re-submission to the ModDB.</change>
				<change>NOTE FOR BLOG STYLERS: U_FEED has been changed to U_BLOG_FEED.</change>
				<change>NOTE FOR TRANSLATORS: Added 1 new language entry in mods/blog/common.php and 2 new entries in mods/blog/acp.php.</change>
				<change>To update from 1.0.3 follow the instructions in contrib/update/103_to_104.xml.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-07-18</date>
			<rev-version>1.0.5</rev-version>
			<changelog lang="en">
				<change>Fixing a bug in the new code added last time for preventing errors when deleting styles.</change>
				<change>NOTE FOR TRANSLATORS: No language entries have been changed.</change>
				<change>To update from 1.0.4 follow the instructions in contrib/update/104_to_105.xml.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-08-20</date>
			<rev-version>1.0.6</rev-version>
			<changelog lang="en">
				<change>Adding the option to change a user's style when editing a profile in the ACP.</change>
				<change>Making the version number a constant in blog/inclueds/constants.php.</change>
				<change>Using the Imageset for the New Entry Icon (only for prosilver based styles).</change>
				<change>Other misc changes suggested by the Mod Team.</change>
				<change>To update from 1.0.5 follow the instructions in contrib/update/105_to_106.xml.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-10-02</date>
			<rev-version>1.0.7</rev-version>
			<changelog lang="en">
				<change>Updating to ModX 1.2.1.</change>
				<change>Fixing a bug which displayed an error when editing an imageset.</change>
				<change>Changing Poll Options to Poll Creation for the title on the tab during posting.</change>
				<change>Adding fix for IE security vulnerability with Blog CSS.</change>
				<change>Other fixes for issues reported by the Mod Team.</change>
				<change>To update from 1.0.6 follow the instructions in contrib/update/106_to_107.xml.</change>
			</changelog>
		</entry>
		<entry>
			<date>2008-11-19</date>
			<rev-version>1.0.8</rev-version>
			<changelog lang="en">
				<change>MSSQL Fixes (Thanks DavidIQ)</change>
				<change>3.0.3 support</change>
			</changelog>
		</entry>
		<entry>
			<date>2009-01-01</date>
			<rev-version>1.0.9</rev-version>
			<changelog lang="en">
				<change>Now using UMIL for installation/updating/uninstallation</change>
				<change>Fixing the two bugs noted here: http://www.lithiumstudios.org/forum/viewtopic.php?f=41&amp;t=1048</change>
				<change>Fixing the bug noted here: http://www.lithiumstudios.org/forum/viewtopic.php?p=8285#p8285</change>
				<change>NOTE FOR TRANSLATORS: A new language file has been added.  It is language/en/mods/blog/umil.php.</change>
			</changelog>
		</entry>
		<entry>
			<date>2009-04-23</date>
			<rev-version>1.0.10</rev-version>
			<changelog lang="en">
				<change>ModX 1.2.2</change>
				<change>Removing the image check in the blog css filter (it was useless and broke some other things)</change>
				<change>Adding quote button to BBCode buttons listed</change>
				<change>Fixing XHTML validation errors</change>
				<change>[Change] Using L_INDEX instead of L_FORUM in Coda Bug #15 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=15</change>
				<change>[Fix] Missing some colons. Bug #17 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=17</change>
				<change>[Fix] Bad encoding for XML feeds.  Bug #25 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=25</change>
				<change>[Fix] Rank images were pointing to the wrong location after phpBB3 fixed a bug in their rank images function.  Bug #34 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=34</change>
				<change>[Fix] REPORTED_SHORT was not defined in the language files.  Bug #39 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=39</change>
				<change>[Fix] WARN_USER should be L_WARN_USER.  Bug #40 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=40</change>
				<change>[Fix] Trim text function broken with _ in the bbcodes.  Bug #42 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=42</change>
				<change>[Fix] Make sure we are not including the blog functions again in the blog/header file if they are already included.  Bug #44 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=44</change>
				<change>[Fix] Do not include the message parser during install unless required.  Bug #47 http://www.lithiumstudios.org/forum/tracker.php?p=1&amp;t=47</change>
			</changelog>
		</entry>
		<entry>
			<date>2009-00-00</date>
			<rev-version>1.0.11-dev</rev-version>
			<changelog lang="en">
				<change>Fixing some issues with URL generation reguarding usernames and other things</change>
				<change>Better URL rewriting rules (now we can handle usernames without the trailing slash!)</change>
				<change>Updating Captcha to work with 3.0.6+</change>
			</changelog>
		</entry>
	</history>

	<link-group>
		<link type="template" href="subsilver2.xml" lang="en">subsilver2</link>
		<link type="template" href="acidtech_tiger.xml" lang="en">Acid Tech Tiger</link>
		<link type="template" href="black_pearl.xml" lang="en">Black Pearl</link>
		<link type="contrib" href="contrib/install_extended.xml" lang="en">Extended Install</link>
	</link-group>
</header>

<action-group>
	<copy>
		<file from="root/*.*" to="*.*" />
	</copy>
	<open src="adm/style/acp_users_profile.html">
		<edit>
			<find><![CDATA[</fieldset>]]></find>
			<action type="after-add"><![CDATA[<!-- INCLUDE acp_blog_users.html -->]]></action>
		</edit>
    </open>
	<open src="includes/acp/acp_language.php">
		<edit>
			<find><![CDATA[, 'button_topic_reply']]></find>
			<inline-edit>
				<inline-find><![CDATA[, 'button_topic_reply']]></inline-find>
				<inline-action type="after-add"><![CDATA[, 'button_blog_new']]></inline-action>
			</inline-edit>
		</edit>
	</open>
	<open src="includes/acp/acp_styles.php">
		<edit>
			<find><![CDATA[, 'button_topic_reply']]></find>
			<inline-edit>
				<inline-find><![CDATA[, 'button_topic_reply']]></inline-find>
				<inline-action type="after-add"><![CDATA[, 'button_blog_new']]></inline-action>
			</inline-edit>
		</edit>
		<edit>
			<find>				$sql = 'UPDATE ' . FORUMS_TABLE . "
					SET forum_style = $new_id
					WHERE forum_style = $style_id";
				$db->sql_query($sql);</find>
			<action type="after-add">				// Start User Blog Mod ----------------------
				global $phpEx;
				include("{$phpbb_root_path}blog/includes/functions_admin.$phpEx");
				blog_remove_style($style_id, $new_id);
				// End User Blog Mod ------------------------</action>
		</edit>
	</open>
	<open src="includes/acp/acp_users.php">
		<edit>
			<find>$cp = new custom_profile();</find>
			<action type="before-add">				// Start User Blog Mod ----------------------
				include("{$phpbb_root_path}blog/includes/functions_admin.$phpEx");
				blog_acp_profile($user_id, $submit);
				// End User Blog Mod ------------------------</action>
		</edit>
	</open>
	<open src="includes/functions.php">
		<edit>
			<find>	// application/xhtml+xml not used because of IE
	header('Content-type: text/html; charset=UTF-8');</find>
			<action type="before-add">	// Start User Blog Mod ----------------------
	include($phpbb_root_path . 'blog/header.' . $phpEx);
	// End User Blog Mod ------------------------</action>
		</edit>
	</open>
	<open src="styles/prosilver/imageset/en/imageset.cfg">
		<edit>
			<comment lang="en">Do this for all prosilver based styles and all languages.</comment>
			<find><![CDATA[img_button_topic_reply = button_topic_reply.gif*25*96]]></find>
			<action type="after-add"><![CDATA[
# User Blog Mod
img_button_blog_new = button_blog_new.gif*25*96]]></action>
		</edit>
	</open>
	<open src="styles/prosilver/template/overall_footer.html">
		<edit>
			<comment lang="en">Do this for all prosilver based styles.</comment>
			<find><![CDATA[<!-- IF TRANSLATION_INFO --><br />{TRANSLATION_INFO}<!-- ENDIF -->]]></find>
			<action type="after-add"><![CDATA[		<!-- IF BLOG_CREDITS --><br />{BLOG_CREDITS}<!-- ENDIF -->]]></action>
		</edit>
	</open>
	<open src="styles/prosilver/template/overall_header.html">
		<edit>
			<comment lang="en">Do this for all prosilver based styles.</comment>
			<find>{U_FAQ}</find>
			<action type="before-add"><![CDATA[				<!-- BEGIN blog_links -->
					<li class="{blog_links.CLASS}"><a href="{blog_links.URL}">{blog_links.TEXT}</a></li>
				<!-- END blog_links -->]]></action>
		</edit>
	</open>
	<open src="styles/prosilver/theme/stylesheet.css">
		<edit>
			<comment lang="en">Do this for all prosilver based styles.</comment>
			<find><![CDATA[@import url("colours.css");]]></find>
			<action type="after-add"><![CDATA[@import url("blog.css");]]></action>
		</edit>
	</open>
	<open src=".htaccess">
		<edit>
			<find><![CDATA[<Files "common.php">
Order Allow,Deny
Deny from All
</Files>]]></find>
			<action type="after-add"><![CDATA[<IfModule mod_rewrite.c>
RewriteEngine on

Rewriterule ^blog/(.+)/(.+).html$		./blog/view/blog.php?page=$1&mode=$2 [NC]
Rewriterule ^blog/(.+).html$			./blog/blog.php?page=$1 [NC]
Rewriterule ^blog/(.+)/$				./blog/view/blog.php?page=$1 [NC]
Rewriterule ^blog/$						./blog/blog.php [NC]

RewriteCond %{REQUEST_FILENAME} !-f
Rewriterule ^blog/(.+)/(.+)$		./blog/view/blog.php?page=$1&mode=$2 [NC]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^blog/(.+)$ ./blog/blog.php?page=$1 [NC]
</IfModule>]]></action>
		</edit>
	</open>
	<open src="viewtopic.php">
		<edit>
			<find><![CDATA['search'		=> ($auth->acl_get('u_search')) ? append_sid("{$phpbb_root_path}search.$phpEx",]]></find>
			<action type="after-add">				'blog_count'	=> ((isset($row['blog_count'])) ? $row['blog_count'] : 0),</action>
		</edit>
		<edit>
			<find>// Load custom profile fields</find>
			<action type="before-add"><![CDATA[// Start Add User Blog Mod ------------------
if (isset($config['user_blog_enable']) && $config['user_blog_enable'])
{
	include($phpbb_root_path . 'blog/includes/constants.' . $phpEx);
	include($phpbb_root_path . 'blog/plugins/plugins.' . $phpEx);
	include($phpbb_root_path . 'blog/includes/functions.' . $phpEx);
	include($phpbb_root_path . 'blog/includes/functions_view.' . $phpEx);
	$user->add_lang('mods/blog/common');
	new blog_plugins();
	get_zebra_info($user->data['user_id'], true);
	get_user_settings($id_cache);
}
// End Add User Blog Mod --------------------]]></action>
		</edit>
		<edit>
			<find>	// Dump vars into template
	$template->assign_block_vars('postrow', $postrow);</find>
			<action type="after-add"><![CDATA[	// Start Add User Blog Mod ------------------
	if (isset($config['user_blog_enable']) && $config['user_blog_enable'])
	{
		add_blog_links($poster_id, 'postrow.custom_fields', $user_cache[$poster_id]);
	}
	// End Add User Blog Mod --------------------]]></action>
		</edit>
	</open>
    <diy-instructions lang="en">Go to yoursite/blog/database.php in your web browser to install the database section.

Set the user/group permissions and configuration settings.</diy-instructions>
</action-group>
</mod>